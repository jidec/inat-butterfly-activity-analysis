---
title: "Data Prep"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(eval = FALSE)
```

Load packages including **colorEvoHelpers**, a package containing personal helpers, and **inatDailyActivity** containing the bias-adjustment pipeline

```{r}

#install_github...
library(colorEvoHelpers)
library(inatDailyActivity)
library(dplyr)
library(tibble)
library(readr)

```

Load in iNat observations data downloaded from GBIF

```{r}

obs_data <- read_delim("data/raw/inat/usa_butterflies_inat_gbif.csv", delim = "\t", escape_double = FALSE, trim_ws = TRUE) # change this to dwc csv format 
```

Add solar hour and season bin columns

```{r}

obs_data_ss <- datetimeToSolarAndSeason(obs_data,season_intervals_per_year = 4)
```

Grid up the data

```{r}

obs_data_gridded <- gridUpDf(obs_data_ss,cellsize_km=250)
```

Create the SSCs

```{r}

sscs <- createSSCs(obs_data_gridded, approach="species_season_year_cell", min_per_ssc=30)
```

Bind climate data

IMPORTANT - this step requires first downloading PRISM climate data using the prism package for all the years and seasons contained in your data, including setting the prism download directory

```{r}

sscs_climate <- bindPrismData(sscs)
```

Merge LepTraits (cite) into SSCs

```{r}

sscs_final <- mergeLeptraitsToSSCs(sscs_climate)
```
