[
  {
    "objectID": "publication_figures.html",
    "href": "publication_figures.html",
    "title": "Publication Figures",
    "section": "",
    "text": "Below are the steps to build the figures shown in our publication\nlibrary(colorEvoHelpers)\n\nWarning: replacing previous import 'dplyr::where' by 'ape::where' when loading\n'colorEvoHelpers'\n\nlibrary(splines)\nlibrary(rr2)\n\nWarning: package 'rr2' was built under R version 4.2.2\n\nlibrary(performance)\n\nWarning: package 'performance' was built under R version 4.2.1\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggpubr)\n\nWarning: package 'ggpubr' was built under R version 4.2.3\n\n\nLoading required package: ggplot2\n\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\nsscs &lt;- readRDS(\"_targets/objects/sscs2\")\nsscs$temp &lt;- sscs$value\nsscs$duration &lt;- sscs$q90_value - sscs$q10_value\nsscs$clade &lt;- sscs$species\ntree &lt;- loadFixTree(tree_location = \"data/raw/bf_species_tree.txt\",remove_first_split = TRUE)\n\nWarning: package 'stringr' was built under R version 4.2.2\n\n\nWarning: package 'ape' was built under R version 4.2.3\n\n\n\nAttaching package: 'ape'\n\n\nThe following object is masked from 'package:ggpubr':\n\n    rotate\n\n\nThe following object is masked from 'package:dplyr':\n\n    where\n\n\nThe following object is masked from 'package:rr2':\n\n    binaryPGLMM\n\nsscs_sp &lt;- sscs %&gt;% group_by(species) %&gt;% summarize(duration=mean(duration),median=mean(median_value),\n                                                onset=mean(q10_value),offset=mean(q90_value),wingspan=mean(wingspan),n=n()) %&gt;% filter(n &gt; 15) %&gt;% mutate(clade=species)\n\nobs_for_family &lt;- readRDS(\"_targets/objects/obs_data\")\nspecies_families &lt;- obs_for_family %&gt;%\n  dplyr::select(family, species) %&gt;%  # Select columns of interest\n  distinct(species, .keep_all = TRUE)\n\nsscs &lt;- merge(sscs,species_families,by=\"species\")\nsscs_and_tree &lt;- trimDfToTree(sscs,tree)\nsscs &lt;- sscs_and_tree[[1]]\ntree &lt;- sscs_and_tree[[2]]"
  },
  {
    "objectID": "publication_figures.html#figure-1.-spatial-temporal-and-taxonomic-distribution-of-sscs",
    "href": "publication_figures.html#figure-1.-spatial-temporal-and-taxonomic-distribution-of-sscs",
    "title": "Publication Figures",
    "section": "Figure 1. Spatial, temporal, and taxonomic distribution of SSCs",
    "text": "Figure 1. Spatial, temporal, and taxonomic distribution of SSCs\n\np &lt;- plotScatterpie(sscs)\n\nWarning: package 'sf' was built under R version 4.2.2\n\n\nLinking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE\n\n\nWarning: package 'rnaturalearth' was built under R version 4.2.3\n\n\nWarning: package 'rnaturalearthdata' was built under R version 4.2.3\n\n\n\nAttaching package: 'rnaturalearthdata'\n\n\nThe following object is masked from 'package:rnaturalearth':\n\n    countries110\n\n\nWarning: package 'ggforce' was built under R version 4.2.3\n\n\nWarning: package 'scatterpie' was built under R version 4.2.3\n\n\n[1] 52\n[1] 463\n\n\nCoordinate system already present. Adding new coordinate system, which will\nreplace the existing one.\n\n\nWarning: Removed 3 rows containing missing values (`geom_segment()`).\n\n\nWarning: Removed 3 rows containing missing values (`geom_text()`)."
  },
  {
    "objectID": "publication_figures.html#figure-2.-duration-of-diel-activity-increases-with-daylength-temperature-and-wingspan",
    "href": "publication_figures.html#figure-2.-duration-of-diel-activity-increases-with-daylength-temperature-and-wingspan",
    "title": "Publication Figures",
    "section": "Figure 2. Duration of diel activity increases with daylength, temperature, and wingspan",
    "text": "Figure 2. Duration of diel activity increases with daylength, temperature, and wingspan\n\nm &lt;- getPlotLM(sscs,model_type=\"pglmm\",bayes=T,response=\"duration\",formula=\"temp_sc + wingspan_sc + daylength_sc + (1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\",tree=tree)\n\nWarning: package 'phyr' was built under R version 4.2.1\n\n\nLoading required package: Matrix\n\n\nWarning: package 'Matrix' was built under R version 4.2.2\n\n\nWarning in checkDepPackageVersion(dep_pkg = \"TMB\"): Package version inconsistency detected.\nglmmTMB was built with TMB version 1.9.0\nCurrent TMB version is 1.9.10\nPlease re-install glmmTMB from source or restore original 'TMB' package (see '?reinstalling' for more information)\n\n\nas(&lt;dsCMatrix&gt;, \"dgCMatrix\") is deprecated since Matrix 1.5-0; do as(., \"generalMatrix\") instead\n\n\nWarning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(density)` instead.\nℹ The deprecated feature was likely used in the phyr package.\n  Please report the issue at &lt;https://github.com/daijiang/phyr/issues&gt;.\n\n\nWarning: package 'car' was built under R version 4.2.2\n\n\nLoading required package: carData\n\n\nWarning: package 'carData' was built under R version 4.2.1\n\n\n\nAttaching package: 'car'\n\n\nThe following object is masked from 'package:dplyr':\n\n    recode\n\n\nLinear mixed model fit by Bayesian INLA\n\nCall:duration ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c98e890e08&gt;\n\nmarginal logLik             DIC            WAIC \n         -14233           28136           28138 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                0.464615 0.68163 0.318061  0.63922\n0 + temp_sc|cell      0.064395 0.25376 0.039707  0.12972\n1|species             0.192922 0.43923 0.099114  0.35556\n1|species__           0.032384 0.17995 0.010403  0.10340\n0 + temp_sc|species   0.047629 0.21824 0.022947  0.09201\n0 + temp_sc|species__ 0.003308 0.05752 0.000874  0.01574\nresidual              5.473424 2.33953 5.291186  5.61383\n\nFixed effects:\n                Value lower.CI upper.CI\n(Intercept)  7.535850 7.360267   7.7057\ntemp_sc      0.402378 0.235405   0.5672\nwingspan_sc  0.300743 0.096354   0.5012\ndaylength_sc 0.265056 0.104667   0.4277\n\nNULL\n\n\nWarning: Objects of class `communityPGLMM` are not supported.\n\n\n\n\n\n[1] NA\n\n# temperature is most reasonable \nprint(rr2::R2(m)) \n\nModels of class pglmm do not have a R2_resid method.\n\n\nModels of class pglmm with bayes = TRUE do not have a R2_lik method.\n\n\nWarning in R2_pred(mod, mod.r, phy = phy, ...): Predictions are made with\ngaussian.pred = nearest_node for models with bayes = TRUE\n\n\n  R2_pred \n0.2226848 \n\nsummary(m)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:duration ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c98e890e08&gt;\n\nmarginal logLik             DIC            WAIC \n         -14233           28136           28138 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                0.464615 0.68163 0.318061  0.63922\n0 + temp_sc|cell      0.064395 0.25376 0.039707  0.12972\n1|species             0.192922 0.43923 0.099114  0.35556\n1|species__           0.032384 0.17995 0.010403  0.10340\n0 + temp_sc|species   0.047629 0.21824 0.022947  0.09201\n0 + temp_sc|species__ 0.003308 0.05752 0.000874  0.01574\nresidual              5.473424 2.33953 5.291186  5.61383\n\nFixed effects:\n                Value lower.CI upper.CI\n(Intercept)  7.535850 7.360267   7.7057\ntemp_sc      0.402378 0.235405   0.5672\nwingspan_sc  0.300743 0.096354   0.5012\ndaylength_sc 0.265056 0.104667   0.4277\n\n# effect of temperature\np1 &lt;- plotPglmmEffect(m, sscs, tree, response_colname = \"duration\", pred_colname=\"temp_sc\", other_pred_colnames = c(\"daylength_sc\",\"wingspan_sc\"), \n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\n\nWarning: package 'tidyverse' was built under R version 4.2.1\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2\n──\n\n\n✔ tibble  3.2.1     ✔ purrr   1.0.1\n✔ tidyr   1.3.0     ✔ forcats 0.5.2\n✔ readr   2.1.2     \n\n\nWarning: package 'tibble' was built under R version 4.2.3\n\n\nWarning: package 'tidyr' was built under R version 4.2.2\n\n\nWarning: package 'readr' was built under R version 4.2.1\n\n\nWarning: package 'purrr' was built under R version 4.2.2\n\n\nWarning: package 'forcats' was built under R version 4.2.1\n\n\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ tidyr::expand() masks Matrix::expand()\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n✖ tidyr::pack()   masks Matrix::pack()\n✖ car::recode()   masks dplyr::recode()\n✖ purrr::some()   masks car::some()\n✖ tidyr::unpack() masks Matrix::unpack()\n✖ ape::where()    masks dplyr::where()\n\np1 &lt;- p1 + labs(x = \"Temperature\", y = \"Daily Activity Duration (Hours)\") + geom_point(data = sscs, aes(x = temp_sc, y = duration),alpha=0.05)\n\n# effect of daylength\np2 &lt;- plotPglmmEffect(m, sscs, tree, response_colname = \"duration\", pred_colname=\"daylength_sc\", other_pred_colnames = c(\"temp_sc\",\"wingspan_sc\"), \n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np2 &lt;- p2 + labs(x = \"Daylength\", y = \"Duration\") + geom_point(data = sscs, aes(x = daylength_sc, y = duration),alpha=0.05)\np2 &lt;- p2 + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())\n\n# effect of wingspan\np3 &lt;- plotPglmmEffect(m, sscs, tree, response_colname = \"duration\", pred_colname=\"wingspan_sc\", other_pred_colnames = c(\"daylength_sc\",\"temp_sc\"), \n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np3 &lt;- p3 + labs(x = \"Wingspan\", y = \"Duration\") + geom_point(data = sscs, aes(x = wingspan_sc, y = duration),alpha=0.05)\np3 &lt;- p3 + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())\n\nggarrange(p1, p2, p3, ncol = 3, nrow = 1)\n\nWarning: Removed 1 rows containing missing values (`geom_point()`)."
  },
  {
    "objectID": "publication_figures.html#figure-3.-effects-of-daylength-temperature-and-wingspan-on-onset-median-and-offset-of-diel-activity",
    "href": "publication_figures.html#figure-3.-effects-of-daylength-temperature-and-wingspan-on-onset-median-and-offset-of-diel-activity",
    "title": "Publication Figures",
    "section": "Figure 3. Effects of daylength, temperature, and wingspan on onset, median, and offset of diel activity",
    "text": "Figure 3. Effects of daylength, temperature, and wingspan on onset, median, and offset of diel activity\n\nrmPlotAxis &lt;- function(p, rm_x=FALSE, rm_y=FALSE){\n  if(rm_y){\n    p &lt;- p + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())\n  }\n  if(rm_x){\n    p &lt;- p + theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank())\n  }\n  return(p)\n}\n\n## onset\nm &lt;- getPlotLM(sscs,model_type=\"pglmm\",bayes=T,response=\"q10_value\",formula=\"temp_sc + wingspan_sc + daylength_sc + (1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\",tree=tree)#, data = sscs, cov_ranef = list(species=tree), bayes=TRUE)# print(vif(m))\n\nLinear mixed model fit by Bayesian INLA\n\nCall:q10_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c9927c8f58&gt;\n\nmarginal logLik             DIC            WAIC \n         -12564           24762           24757 \n\nRandom effects:\n                       Variance  Std.Dev  lower.CI  upper.CI\n1|cell                1.819e+00 1.348645 1.599e+00 2.0766409\n0 + temp_sc|cell      2.362e-02 0.153696 1.256e-02 0.0575767\n1|species             3.546e-02 0.188305 1.578e-02 0.0906553\n1|species__           9.341e-03 0.096651 3.719e-03 0.0275801\n0 + temp_sc|species   5.618e-03 0.074954 2.673e-03 0.0129578\n0 + temp_sc|species__ 5.105e-05 0.007145 1.936e-05 0.0001502\nresidual              3.182e+00 1.783821 3.053e+00 3.3237698\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  10.248203 10.095841  10.4038\ntemp_sc      -0.078420 -0.244862   0.0926\nwingspan_sc  -0.032679 -0.128116   0.0671\ndaylength_sc -0.405445 -0.592831  -0.2223\n\nNULL\n\n\nWarning: Objects of class `communityPGLMM` are not supported.\n\n\n\n\n\n[1] NA\n\nprint(rr2::R2(m))\n\nModels of class pglmm do not have a R2_resid method.\n\n\nModels of class pglmm with bayes = TRUE do not have a R2_lik method.\n\n\nWarning in R2_pred(mod, mod.r, phy = phy, ...): Predictions are made with\ngaussian.pred = nearest_node for models with bayes = TRUE\n\n\n  R2_pred \n0.3796571 \n\nsummary(m)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:q10_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c9927c8f58&gt;\n\nmarginal logLik             DIC            WAIC \n         -12564           24762           24757 \n\nRandom effects:\n                       Variance  Std.Dev  lower.CI  upper.CI\n1|cell                1.819e+00 1.348645 1.599e+00 2.0766409\n0 + temp_sc|cell      2.362e-02 0.153696 1.256e-02 0.0575767\n1|species             3.546e-02 0.188305 1.578e-02 0.0906553\n1|species__           9.341e-03 0.096651 3.719e-03 0.0275801\n0 + temp_sc|species   5.618e-03 0.074954 2.673e-03 0.0129578\n0 + temp_sc|species__ 5.105e-05 0.007145 1.936e-05 0.0001502\nresidual              3.182e+00 1.783821 3.053e+00 3.3237698\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  10.248203 10.095841  10.4038\ntemp_sc      -0.078420 -0.244862   0.0926\nwingspan_sc  -0.032679 -0.128116   0.0671\ndaylength_sc -0.405445 -0.592831  -0.2223\n\n# effect of temp\np1 &lt;- plotPglmmEffect(m,sscs,tree,response_colname = \"q10_value\",pred_colname = \"temp_sc\",other_pred_colnames = c(\"wingspan_sc\",\"daylength_sc\"), \n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np1 &lt;- p1 + labs(x = \"Temperature\", y = \"Onset\") + geom_point(data = sscs, aes(x = temp_sc, y = q10_value),alpha=0.05)\n# effect of daylength\np2 &lt;- plotPglmmEffect(m,sscs,tree,response_colname = \"q10_value\",pred_colname = \"daylength_sc\",other_pred_colnames = c(\"wingspan_sc\",\"temp_sc\"), \n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np2 &lt;- p2 + labs(x = \"Daylength\", y = \"Onset\") + geom_point(data = sscs, aes(x = daylength_sc, y = q10_value),alpha=0.05)\np2 &lt;- rmPlotAxis(p2,rm_y=TRUE)\n# effect of wingspan \np3 &lt;- plotPglmmEffect(m,sscs,tree,response_colname = \"q10_value\",pred_colname = \"wingspan_sc\",other_pred_colnames = c(\"temp_sc\",\"daylength_sc\"),\n                     random_effect_colnames = c(\"species\",\"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np3 &lt;- p3 + labs(x = \"Wingspan\", y = \"Onset\") + geom_point(data = sscs, aes(x = wingspan_sc, y = q10_value),alpha=0.05)\np3 &lt;- p3 + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())\np3 &lt;- rmPlotAxis(p3,rm_y=TRUE)\n\n\n## median\nm &lt;- getPlotLM(sscs, model_type=\"pglmm\", bayes=T, response=\"median_value\", formula=\"temp_sc + wingspan_sc + daylength_sc + (1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\", tree=tree)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:median_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c98ed61908&gt;\n\nmarginal logLik             DIC            WAIC \n         -12487           24373           24398 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                4.715998 2.17163 3.493442  6.91940\n0 + temp_sc|cell      0.093812 0.30629 0.062777  0.15863\n1|species             0.130240 0.36089 0.077700  0.26211\n1|species__           0.021965 0.14821 0.011787  0.04545\n0 + temp_sc|species   0.075613 0.27498 0.047206  0.11799\n0 + temp_sc|species__ 0.006985 0.08357 0.003237  0.01650\nresidual              2.941175 1.71499 2.849423  3.03823\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  13.801627 13.617343  13.9862\ntemp_sc       0.124807 -0.088472   0.3405\nwingspan_sc   0.072232 -0.079528   0.2274\ndaylength_sc -0.307055 -0.524460  -0.0907\n\nNULL\n\n\nWarning: Objects of class `communityPGLMM` are not supported.\n\n\n\n\n\n[1] NA\n\nprint(rr2::R2(m))\n\nModels of class pglmm do not have a R2_resid method.\nModels of class pglmm with bayes = TRUE do not have a R2_lik method.\n\n\nWarning in R2_pred(mod, mod.r, phy = phy, ...): Predictions are made with\ngaussian.pred = nearest_node for models with bayes = TRUE\n\n\n  R2_pred \n0.6250751 \n\nsummary(m)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:median_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002c98ed61908&gt;\n\nmarginal logLik             DIC            WAIC \n         -12487           24373           24398 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                4.715998 2.17163 3.493442  6.91940\n0 + temp_sc|cell      0.093812 0.30629 0.062777  0.15863\n1|species             0.130240 0.36089 0.077700  0.26211\n1|species__           0.021965 0.14821 0.011787  0.04545\n0 + temp_sc|species   0.075613 0.27498 0.047206  0.11799\n0 + temp_sc|species__ 0.006985 0.08357 0.003237  0.01650\nresidual              2.941175 1.71499 2.849423  3.03823\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  13.801627 13.617343  13.9862\ntemp_sc       0.124807 -0.088472   0.3405\nwingspan_sc   0.072232 -0.079528   0.2274\ndaylength_sc -0.307055 -0.524460  -0.0907\n\n# Effect of temperature on median_value\np4 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"median_value\", pred_colname=\"temp_sc\", other_pred_colnames=c(\"wingspan_sc\", \"daylength_sc\"), \n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np4 &lt;- p4 + labs(x = \"Temperature\", y = \"Peak\") + geom_point(data = sscs, aes(x = temp_sc, y = median_value), alpha=0.05)\np4 &lt;- rmPlotAxis(p4,rm_x=TRUE)\n# Effect of daylength on median_value\np5 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"median_value\", pred_colname=\"daylength_sc\", other_pred_colnames=c(\"wingspan_sc\", \"temp_sc\"), \n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np5 &lt;- p5 + labs(x = \"Daylength\", y = \"Peak\") + geom_point(data = sscs, aes(x = daylength_sc, y = median_value), alpha=0.05)\np5 &lt;- rmPlotAxis(p5,rm_x=TRUE,rm_y=TRUE)\n# Effect of wingspan on median_value\np6 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"median_value\", pred_colname=\"wingspan_sc\", other_pred_colnames=c(\"temp_sc\", \"daylength_sc\"),\n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np6 &lt;- p6 + labs(x = \"Wingspan\", y = \"Peak\") + geom_point(data = sscs, aes(x = wingspan_sc, y = median_value), alpha=0.05)\np6 &lt;- rmPlotAxis(p6,rm_x=TRUE,rm_y=TRUE)\n\n\n## offset\nm &lt;- getPlotLM(sscs, model_type=\"pglmm\", bayes=T, response=\"q90_value\", formula=\"temp_sc + wingspan_sc + daylength_sc + (1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\", tree=tree)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:q90_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002ca5f8b6910&gt;\n\nmarginal logLik             DIC            WAIC \n         -12661           24812           24846 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                 1.70298  1.3050 1.218304  2.46981\n0 + temp_sc|cell       0.05753  0.2399 0.038733  0.09411\n1|species              0.21038  0.4587 0.108788  0.43022\n1|species__            0.02182  0.1477 0.013094  0.03847\n0 + temp_sc|species    0.08991  0.2998 0.048254  0.21360\n0 + temp_sc|species__  0.01746  0.1321 0.008395  0.03766\nresidual               3.17802  1.7827 3.027280  3.42715\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  17.705725 17.536683  17.8738\ntemp_sc       0.205329  0.015413   0.3951\nwingspan_sc   0.283905  0.130835   0.4384\ndaylength_sc  0.028000 -0.158809   0.2151\n\nNULL\n\n\nWarning: Objects of class `communityPGLMM` are not supported.\n\n\n\n\n\n[1] NA\n\nprint(rr2::R2(m))\n\nModels of class pglmm do not have a R2_resid method.\nModels of class pglmm with bayes = TRUE do not have a R2_lik method.\n\n\nWarning in R2_pred(mod, mod.r, phy = phy, ...): Predictions are made with\ngaussian.pred = nearest_node for models with bayes = TRUE\n\n\n  R2_pred \n0.4621541 \n\nsummary(m)\n\nLinear mixed model fit by Bayesian INLA\n\nCall:q90_value ~ temp_sc + wingspan_sc + daylength_sc\n&lt;environment: 0x000002ca5f8b6910&gt;\n\nmarginal logLik             DIC            WAIC \n         -12661           24812           24846 \n\nRandom effects:\n                      Variance Std.Dev lower.CI upper.CI\n1|cell                 1.70298  1.3050 1.218304  2.46981\n0 + temp_sc|cell       0.05753  0.2399 0.038733  0.09411\n1|species              0.21038  0.4587 0.108788  0.43022\n1|species__            0.02182  0.1477 0.013094  0.03847\n0 + temp_sc|species    0.08991  0.2998 0.048254  0.21360\n0 + temp_sc|species__  0.01746  0.1321 0.008395  0.03766\nresidual               3.17802  1.7827 3.027280  3.42715\n\nFixed effects:\n                 Value  lower.CI upper.CI\n(Intercept)  17.705725 17.536683  17.8738\ntemp_sc       0.205329  0.015413   0.3951\nwingspan_sc   0.283905  0.130835   0.4384\ndaylength_sc  0.028000 -0.158809   0.2151\n\n# Effect of temperature on q90_value\np7 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"q90_value\", pred_colname=\"temp_sc\", other_pred_colnames=c(\"wingspan_sc\", \"daylength_sc\"), \n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) +s (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np7 &lt;- p7 + labs(x = \"Temperature\", y = \"Offset\") + geom_point(data = sscs, aes(x = temp_sc, y = q90_value), alpha=0.05)\np7 &lt;- rmPlotAxis(p7,rm_x=TRUE)\n# Effect of daylength on q90_value\np8 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"q90_value\", pred_colname=\"daylength_sc\", other_pred_colnames=c(\"wingspan_sc\", \"temp_sc\"), \n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np8 &lt;- p8 + labs(x = \"Daylength\", y = \"Offset\") + geom_point(data = sscs, aes(x = daylength_sc, y = q90_value), alpha=0.05)\np8 &lt;- rmPlotAxis(p8,rm_y=TRUE,rm_x=TRUE)\n# Effect of wingspan on q90_value\np9 &lt;- plotPglmmEffect(m, sscs, tree, response_colname=\"q90_value\", pred_colname=\"wingspan_sc\", other_pred_colnames=c(\"temp_sc\", \"daylength_sc\"),\n                     random_effect_colnames=c(\"species\", \"cell\"), random_effects_formula=\"(1|cell) + (0+temp_sc|cell) + (1|species__) + (0+temp_sc|species__)\")\np9 &lt;- p9 + labs(x = \"Wingspan\", y = \"Offset\") + geom_point(data = sscs, aes(x = wingspan_sc, y = q90_value), alpha=0.05)\np9 &lt;- p9 + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())\np9 &lt;- rmPlotAxis(p9,rm_y=TRUE,rm_x=TRUE)\n\nggarrange(p7,p8,p9,p4,p5,p6,p1,p2,p3, ncol = 3, nrow = 3)\n\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n\n\nWarning: Removed 1 rows containing missing values (`geom_point()`).\nRemoved 1 rows containing missing values (`geom_point()`)."
  },
  {
    "objectID": "publication_figures.html#figure-4.-activity-duration-is-the-most-phylogenetically-conserved-activity-trait",
    "href": "publication_figures.html#figure-4.-activity-duration-is-the-most-phylogenetically-conserved-activity-trait",
    "title": "Publication Figures",
    "section": "Figure 4. Activity duration is the most phylogenetically conserved activity trait",
    "text": "Figure 4. Activity duration is the most phylogenetically conserved activity trait\n\nsscs_sp &lt;- sscs %&gt;% group_by(species) %&gt;% summarize(duration=mean(duration),median=mean(median_value),\n                                                onset=mean(q10_value),offset=mean(q90_value),wingspan=mean(wingspan),n=n()) %&gt;% filter(n &gt; 15) %&gt;% mutate(clade=species)\n\nassessTraitsOnTree(sscs_sp, trait_colname = \"duration\",tree=tree)\n\nLoading required package: maps\n\n\n\nAttaching package: 'maps'\n\n\nThe following object is masked from 'package:purrr':\n\n    map\n\n\n\nAttaching package: 'phytools'\n\n\nThe following object is masked from 'package:ape':\n\n    drop.tip.multiPhylo\n\n\nWarning: package 'caper' was built under R version 4.2.3\n\n\nLoading required package: MASS\n\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:dplyr':\n\n    select\n\n\nLoading required package: mvtnorm\n\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 0.141633 \nP-value (based on 1000 randomizations) : 0.74 \n\n\n\n\n\n\nPhylogenetic signal lambda : 0.218009 \nlogL(lambda) : -90.2409 \n\nassessTraitsOnTree(sscs_sp, trait_colname = \"onset\",tree=tree)\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 0.126228 \nP-value (based on 1000 randomizations) : 0.895 \n\n\n\n\n\n\nPhylogenetic signal lambda : 6.6107e-05 \nlogL(lambda) : -97.0204 \n\nassessTraitsOnTree(sscs_sp, trait_colname = \"median\",tree=tree)\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 0.109857 \nP-value (based on 1000 randomizations) : 0.973 \n\n\n\n\n\n\nPhylogenetic signal lambda : 6.6107e-05 \nlogL(lambda) : -137.006 \n\nassessTraitsOnTree(sscs_sp, trait_colname = \"offset\",tree=tree)\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 0.112471 \nP-value (based on 1000 randomizations) : 0.949 \n\n\n\n\n\n\nPhylogenetic signal lambda : 6.6107e-05 \nlogL(lambda) : -121.087 \n\n\nWingspan and duration are phylogenetically correlated\n\ncor.test(sscs_sp$duration,sscs_sp$wingspan)\n\n\n    Pearson's product-moment correlation\n\ndata:  sscs_sp$duration and sscs_sp$wingspan\nt = 3.3574, df = 68, p-value = 0.001292\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.1559269 0.5622415\nsample estimates:\n     cor \n0.377085 \n\nassessTraitsOnTree(sscs_sp, trait_colname = \"duration\",trait_colname2=\"wingspan\",tree=tree)\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 0.141633 \nP-value (based on 1000 randomizations) : 0.743 \n\n\n\nPhylogenetic signal lambda : 0.218009 \nlogL(lambda) : -90.2409 \n\n\nlegend scale cannot be longer than total tree length; resetting\n\n\n\n\n\n\n\n\n\n\n\n\nPhylogenetic signal K : 1.46274 \nP-value (based on 1000 randomizations) : 0.001 \n\n\n\n\n\n\nPhylogenetic signal lambda : 0.924629 \nlogL(lambda) : -116.561 \n\n\n\nAttaching package: 'nlme'\n\n\nThe following object is masked from 'package:lme4':\n\n    lmList\n\n\nThe following object is masked from 'package:dplyr':\n\n    collapse\n\n\nWarning in Initialize.corPhyl(X[[i]], ...): No covariate specified, species\nwill be taken as ordered in the data frame. To avoid this message, specify a\ncovariate containing the species names with the 'form' argument.\n\n\nDenom. DF: 68 \n            numDF   F-value p-value\n(Intercept)     1 184.30424  &lt;.0001\nwingspan        1  19.93224  &lt;.0001\n\n\nConverting into numeric values currently not possible for variables of\n  class 'NULL'.\n\n\nWarning in mean.default(resp, na.rm = TRUE): argument is not numeric or\nlogical: returning NA\n\n\n\n\n\n  R2: NaN"
  },
  {
    "objectID": "publication_figures.html#figure-5.-visualizing-sscs",
    "href": "publication_figures.html#figure-5.-visualizing-sscs",
    "title": "Publication Figures",
    "section": "Figure 5. Visualizing SSCs",
    "text": "Figure 5. Visualizing SSCs"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "About",
    "section": "",
    "text": "This is a “papers with code” website for “Using iNaturalist to understand trait and climate drivers of daily activity patterns in temperate butterflies” in prep."
  },
  {
    "objectID": "index.html#intro",
    "href": "index.html#intro",
    "title": "About",
    "section": "Intro",
    "text": "Intro\nAnimals are expected to optimize the times that they are active to maximize their fitness in the face of constraints of light availability, temperature, competition, and predation pressure. It is difficult to impossible to obtain data on activity regimes with spatial, temporal, and taxonomic breath. This project grapples with the distinctive biases of iNaturalist data to explore patterns and trade-offs of activity in butterflies."
  },
  {
    "objectID": "index.html#questions",
    "href": "index.html#questions",
    "title": "About",
    "section": "Questions",
    "text": "Questions\n\nDo butterflies species have different activity regimes/niches and if so what are they?\nWhen daylength is longer and temperature is hotter, do butterflies start their activity earlier in the day and end it later?\nDo smaller species have different activity regimes than larger species?\nDo species with a preference for open unshaded environments have different regimes?"
  },
  {
    "objectID": "index.html#predictions-based-on-previous-research",
    "href": "index.html#predictions-based-on-previous-research",
    "title": "About",
    "section": "Predictions based on previous research",
    "text": "Predictions based on previous research\n\nButterflies will start earlier and end later when days are longer and temperature is warmer\nSmaller species will forage less in the middle of the day because they are less able to dissipate heat, ESPECIALLY in hot environments"
  },
  {
    "objectID": "data_prep.html",
    "href": "data_prep.html",
    "title": "Data Prep",
    "section": "",
    "text": "Load packages including colorEvoHelpers, a package containing personal helpers, and inatDailyActivity containing the bias-adjustment pipeline\n\n#install_github...\nlibrary(colorEvoHelpers)\nlibrary(inatDailyActivity)\nlibrary(dplyr)\nlibrary(tibble)\nlibrary(readr)\n\nLoad in iNat observations data downloaded from GBIF\n\nobs_data &lt;- read_delim(\"data/raw/inat/usa_butterflies_inat_gbif.csv\", delim = \"\\t\", escape_double = FALSE, trim_ws = TRUE) # change this to dwc csv format \n\nAdd solar hour and season bin columns\n\nobs_data_ss &lt;- datetimeToSolarAndSeason(obs_data,season_intervals_per_year = 4)\n\nGrid up the data\n\nobs_data_gridded &lt;- gridUpDf(obs_data_ss,cellsize_km=250)\n\nCreate the SSCs\n\nsscs &lt;- createSSCs(obs_data_gridded, approach=\"species_season_year_cell\", min_per_ssc=30)\n\nBind climate data\nIMPORTANT - this step requires first downloading PRISM climate data using the prism package for all the years and seasons contained in your data, including setting the prism download directory\n\nsscs_climate &lt;- bindPrismData(sscs)\n\nMerge LepTraits (cite) into SSCs\n\nsscs_final &lt;- mergeLeptraitsToSSCs(sscs_climate)"
  },
  {
    "objectID": "descriptive.html",
    "href": "descriptive.html",
    "title": "Descriptive",
    "section": "",
    "text": "library(colorEvoHelpers)\n\nWarning: replacing previous import 'dplyr::where' by 'ape::where' when loading\n'colorEvoHelpers'\n\nlibrary(inatDailyActivity)\nlibrary(stringr)\n\nWarning: package 'stringr' was built under R version 4.2.2\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nsscs &lt;- readRDS(\"_targets/objects/sscs2\")"
  },
  {
    "objectID": "descriptive.html#how-are-sscs-spatially-distributed",
    "href": "descriptive.html#how-are-sscs-spatially-distributed",
    "title": "Descriptive",
    "section": "How are SSCs spatially distributed?",
    "text": "How are SSCs spatially distributed?\n\nstr_c(\"Number of unique cells: \", length(unique(sscs$cell)))\n\n[1] \"Number of unique cells: 131\"\n\n\n\nsscs$latitude &lt;- sscs$cell_lat\nsscs$longitude &lt;- sscs$cell_lon\nhist(sscs$latitude)\n\n\n\nhist(sscs$longitude)\n\n\n\n\n\nplotLatLonHeatmap(sscs)\n\nWarning: package 'mapdata' was built under R version 4.2.2\n\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\n\nWarning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(density)` instead.\nℹ The deprecated feature was likely used in the colorEvoHelpers package.\n  Please report the issue to the authors."
  },
  {
    "objectID": "descriptive.html#how-are-species-sampled",
    "href": "descriptive.html#how-are-species-sampled",
    "title": "Descriptive",
    "section": "How are species sampled?",
    "text": "How are species sampled?\n\nstr_c(\"Number of unique species: \", length(unique(sscs$species)))\n\n[1] \"Number of unique species: 274\"\n\n\n\n# count the number of occurrences of each species\nspecies_counts &lt;- table(sscs$species)\n# create a bar plot\nbarplot(species_counts, \n        main = \"Distribution of Data by Species\", \n        xlab = \"Species\", \n        ylab = \"Number of Records\", \n        col = \"blue\",\n        las = 2)\n\n\n\n\n\nhist(table(sscs$species),breaks=100,main=\"Distribution of species having at least X obs\",ylab=\"# species\",xlab=\"X Count Threshold\")\n\n\n\n\n\n# Count the occurrences of each species and sort\nspecies_counts &lt;- sort(table(sscs$species), decreasing = TRUE)\n\n# Choose a cutoff, e.g., top 20 species (adjusting your original top_n to match your example)\ntop_n &lt;- 20\ntop_species_counts &lt;- head(species_counts, top_n)\n\n# Sum the rest into the 'Other' category\nother_count &lt;- sum(tail(species_counts, -top_n))\ntop_species_counts &lt;- c(top_species_counts, Other = other_count)\n\n# Create a bar plot for the top N species + \"Other\"\nbarplot(top_species_counts, \n        main = \"Top Species by Number of SSCs\", \n        xlab = \"\", \n        ylab = \"# SSCs\", \n        col = \"blue\",\n        las = 2)  # This rotates the labels on the x-axis to make them more readable\n\n\n\n\n\n# Sort species by count\nspecies_counts &lt;- sort(table(sscs$species), decreasing = TRUE)\n\n# Calculate cumulative percentage\ncumulative_perc &lt;- cumsum(species_counts) / sum(species_counts) * 100\n\n# Create a bar plot for cumulative percentage\nbarplot(cumulative_perc, \n        main = \"Cumulative Percentage of Records by Species\", \n        xlab = \"Species\", \n        ylab = \"Cumulative Percentage\", \n        col = \"green\",\n        las = 2)"
  },
  {
    "objectID": "descriptive.html#how-is-wingspan-distributed",
    "href": "descriptive.html#how-is-wingspan-distributed",
    "title": "Descriptive",
    "section": "How is wingspan distributed?",
    "text": "How is wingspan distributed?\n\nplot(hist(sscs$wingspan))"
  },
  {
    "objectID": "descriptive.html#how-is-habitat-preference-distributed",
    "href": "descriptive.html#how-is-habitat-preference-distributed",
    "title": "Descriptive",
    "section": "How is habitat preference distributed?",
    "text": "How is habitat preference distributed?\n\nbarplot(prop.table(table(sscs$open_closed)))"
  },
  {
    "objectID": "descriptive.html#what-does-the-overall-curve-look-like",
    "href": "descriptive.html#what-does-the-overall-curve-look-like",
    "title": "Descriptive",
    "section": "What does the overall curve look like?",
    "text": "What does the overall curve look like?\n\nobs_gridded &lt;- readRDS(\"_targets/objects/obs_gridded\")\n\n# Create a density plot\nggplot(obs_gridded, aes(x = local_hour)) +\n  geom_histogram(binwidth = 1) +\n  labs(title = \"Butterfly Observations Across the Day\", x = \"Hour of the Day\", y = \"Density\") + \n    scale_x_continuous(breaks = seq(0, 23, by = 1), labels = seq(0, 23, by = 1),limits=c(8,21))\n\nWarning: Removed 66669 rows containing non-finite values (`stat_bin()`).\n\n\nWarning: Removed 2 rows containing missing values (`geom_bar()`)."
  },
  {
    "objectID": "descriptive.html#are-effects-only-for-certain-families",
    "href": "descriptive.html#are-effects-only-for-certain-families",
    "title": "Descriptive",
    "section": "Are effects only for certain families?",
    "text": "Are effects only for certain families?\n\n#obs_for_family &lt;- readRDS(\"_targets/objects/obs_data\")\n#species_families &lt;- obs_for_family %&gt;%\n#  dplyr::select(family, species) %&gt;%  # Select columns of interest\n#  distinct(species, .keep_all = TRUE)\n\n#sscs &lt;- readRDS(\"_targets/objects/sscs2\")\n#sscs &lt;- merge(sscs,species_families,by=\"species\")\n#sscs$duration &lt;- sscs$median_upper - sscs$median_lower\n#library(lme4)\n#library(sjPlot)\n\n#m &lt;- lmer(duration ~ (1+temp_sc|family) + (1+wingspan|family), data=sscs)\n#plot_model(m, type=\"pred\", terms=c(\"temp_sc\",\"wingspan\",\"family\"), pred.type=\"re\", ci.lvl=NA)"
  },
  {
    "objectID": "bias_adjust_example.html",
    "href": "bias_adjust_example.html",
    "title": "Bias Adjust Example",
    "section": "",
    "text": "Below is an example applying the bias-adjustment approach to one well-sampled 250 km grid cell (either DC or LA).\nLoad and filter raw observations data\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggplot2)\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\nlibrary(tidyr)\n\nWarning: package 'tidyr' was built under R version 4.2.2\n\nobs_data &lt;- readRDS(\"_targets/objects/obs_gridded\")\nobs_data &lt;- subset(obs_data, select = -c(geometry))\nobs_data &lt;- filter(obs_data, local_hour &gt;= 7)\nobs_data &lt;- filter(obs_data, local_hour &lt;= 20)\n\nFind a cell with a lot of observations\n\ncells &lt;- obs_data %&gt;%\n  group_by(cell) %&gt;%\n  summarise(n_obs=n(), lat=mean(decimalLatitude), lon=mean(decimalLongitude))\n\ncell_id &lt;- 178 #washington DC\n\nFilter to that cell\n\none_cell_data &lt;- filter(obs_data, cell == cell_id)\n  \nsampling_effort &lt;- one_cell_data %&gt;%\n  group_by(season, local_hour) %&gt;%\n  summarise(n_obs = n())\n\n`summarise()` has grouped output by 'season'. You can override using the\n`.groups` argument.\n\n\nMake 4 GAMs one per season\n\nseason_list &lt;- c(\"1\",\"2\",\"3\",\"4\")\ngam &lt;- lapply(season_list, function(s) {\n  df &lt;- dplyr::filter(sampling_effort, season == s)\n  m &lt;- mgcv::gam(n_obs~s(local_hour), data=df, family = \"poisson\")\n  pred_df &lt;- data.frame(local_hour = 7:20)\n  pred &lt;- predict(m, pred_df)\n  out &lt;- data.frame(pred_df, effort = pred, season = s)\n  return(out)\n}) %&gt;%\n  bind_rows()\n\nprint(gam)\n\n        local_hour     effort season\n1...1            7  0.4441158      1\n2...2            8  1.1016842      1\n3...3            9  1.5883426      1\n4...4           10  1.8142364      1\n5...5           11  2.0143980      1\n6...6           12  2.4459697      1\n7...7           13  3.0564578      1\n8...8           14  3.4854602      1\n9...9           15  3.4343252      1\n10...10         16  2.9964900      1\n11...11         17  2.4027545      1\n12...12         18  1.6719195      1\n13...13         19  0.7919754      1\n14...14         20 -0.1369812      1\n1...15           7  2.7265823      2\n2...16           8  2.7643207      2\n3...17           9  3.6280930      2\n4...18          10  5.0310024      2\n5...19          11  6.2471300      2\n6...20          12  7.0362640      2\n7...21          13  7.4102192      2\n8...22          14  7.4534488      2\n9...23          15  7.3856508      2\n10...24         16  7.2665649      2\n11...25         17  6.9692971      2\n12...26         18  6.4514878      2\n13...27         19  5.7013438      2\n14...28         20  4.7465042      2\n1...29           7  4.0658855      3\n2...30           8  4.2079763      3\n3...31           9  5.2800132      3\n4...32          10  6.8840329      3\n5...33          11  8.0766002      3\n6...34          12  8.6142653      3\n7...35          13  8.7268815      3\n8...36          14  8.6312211      3\n9...37          15  8.5249488      3\n10...38         16  8.4667170      3\n11...39         17  8.3313862      3\n12...40         18  7.9926513      3\n13...41         19  7.3795088      3\n14...42         20  6.5442885      3\n1...43           7  2.4928985      4\n2...44           8  2.2045961      4\n3...45           9  3.2078133      4\n4...46          10  4.9617724      4\n5...47          11  6.4246390      4\n6...48          12  7.3975836      4\n7...49          13  7.8720488      4\n8...50          14  7.9649009      4\n9...51          15  8.0404577      4\n10...52         16  8.0291599      4\n11...53         17  7.7101808      4\n12...54         18  7.1892604      4\n13...55         19  6.2618675      4\n14...56         20  4.7170018      4\n\n#Viz\ngam %&gt;%\n  ggplot() +\n  geom_col(aes(x=local_hour, y = effort), color = \"black\") +\n  facet_wrap(~season) +\n  ggtitle(\"Sampling Effort Across Seasons\")\n\n\n\n\nAppend inverse effort back to original data\n\none_cell_data &lt;- one_cell_data %&gt;%\n  left_join(gam, by = c(\"local_hour\", \"season\")) %&gt;%\n  dplyr::mutate(\n    inverse_effort = 1/effort\n  )\n\nLook at a test species and compare adjusted and unadjusted data\n\n### Subsample -- test species. ----\ntestspecies &lt;- one_cell_data %&gt;%\n  dplyr::filter(species == \"Pieris rapae\")\n\ntest &lt;- testspecies %&gt;%\n  group_by(season) %&gt;%\n  dplyr::sample_n(size = nrow(testspecies), replace = T, weight = inverse_effort)\n\n# Raw observation data.\ntestspecies %&gt;%\n  ggplot() +\n  geom_bar(aes(local_hour), color = \"black\") +\n  facet_wrap(~season) + \n  ggtitle(\"Raw Observation Activity Curves Per Season For Pieris rapae in Washington DC\")\n\n\n\n# subsampled observation data.\ntest %&gt;%\n  ggplot() +\n  geom_bar(aes(local_hour), color = \"black\") +\n  facet_wrap(~season) + \n  ggtitle(\"Adjusted Activity Curves Per Season For Pieris rapae in Washington DC\")\n\n\n\n\nCreate bootstrap function\n\nmy_bootstrap &lt;- function(hours, inv_efforts, nbootstraps=50){\n      bootstrap_medians &lt;- numeric(nbootstraps)\n      bootstrap_q10s &lt;- numeric(nbootstraps)\n      bootstrap_q90s &lt;- numeric(nbootstraps)\n\n      # Perform bootstrapping\n      for (i in 1:nbootstraps) {\n        sampled_hours &lt;- sample(hours, replace=TRUE, size=length(hours), prob=inv_efforts)\n        bootstrap_medians[i] &lt;- median(sampled_hours)\n        bootstrap_q10s[i] &lt;- quantile(sampled_hours,0.1)\n        bootstrap_q90s[i] &lt;- quantile(sampled_hours,0.9)\n      }\n\n      # Calculate the 5th percentile, median, and 95th percentile\n      median_lower &lt;- quantile(bootstrap_medians, probs = 0.05)\n      median_value &lt;- median(bootstrap_medians)\n      median_upper &lt;- quantile(bootstrap_medians, probs = 0.95)\n\n      q10_lower &lt;- quantile(bootstrap_q10s, probs=0.05)\n      q10_value &lt;- median(bootstrap_q10s)\n      q10_upper &lt;- quantile(bootstrap_q10s, probs=0.95)\n\n      q90_lower &lt;- quantile(bootstrap_q90s, probs=0.05)\n      q90_value &lt;- median(bootstrap_q90s)\n      q90_upper &lt;- quantile(bootstrap_q90s, probs=0.95)\n\n      # Return the results\n      return(list(median_lower = median_lower, median_value = median_value, median_upper = median_upper,\n                  q10_lower = q10_lower, q10_value = q10_value, q10_upper = q10_upper,\n                  q90_lower = q90_lower, q90_value = q90_value, q90_upper = q90_upper))\n    }\n\nApply to SSCs\n\nmin_per_ssc &lt;- 30\nsscs &lt;- one_cell_data %&gt;%\n  group_by(species, season) %&gt;%\n  filter(n() &gt;= min_per_ssc) %&gt;%\n  summarize(\n    bootstrap_results = list(my_bootstrap(local_hour, inverse_effort)),\n    raw_median_value = median(local_hour),\n    raw_q10_value = quantile(local_hour,0.1),\n    raw_q90_value = quantile(local_hour,0.9),\n  ) %&gt;%\n  unnest_wider(bootstrap_results) \n\n`summarise()` has grouped output by 'species'. You can override using the\n`.groups` argument.\n\n\nVisualize species\n\nmycolors &lt;- c(summer = \"#C5283D\", winter = \"#1C3144\", monsoon = \"#228B22\")\n\nspecies_list &lt;- as.vector(unique(sscs$species))[1:10]\n#species_list &lt;- as.vector(species_list[1:10,])\nsscs %&gt;%\n  filter(species %in% species_list) %&gt;%\n # Filter original df to keep only rows of the sampled species\n  #dplyr::arrange(desc(median)) %&gt;%\n  ggplot() +\n  aes(y = species, yend = species, color = season) +\n  #geom_segment(aes(x = lower_bound, xend = upper_bound),color = \"blue\", alpha = 0.5) +\n  geom_point(aes(x = median_value), color = \"blue\", alpha = 0.5) +\n  geom_segment(aes(x = q10_value, xend = q90_value),color = \"blue\", alpha = 0.5) +\n  geom_point(aes(x = raw_median_value), color = \"red\", alpha = 0.5) +\n  geom_segment(aes(x = raw_q10_value, xend = raw_q90_value),color = \"red\", alpha = 0.5) +\n  #geom_point(aes(x = raw_median), color = \"red\", alpha = 0.5) +\n  scale_color_manual(values = mycolors) +\n  labs(title = \"Median Shifts\", \n       x = \"Hour\",\n       y = \"Common Name\")"
  },
  {
    "objectID": "bimodality.html",
    "href": "bimodality.html",
    "title": "Extra: Bimodality",
    "section": "",
    "text": "This is a shot at visualizing and quantitatively assessing relative bimodality of activity curves.\nFirst make new SSCs keeping track of individual observations.\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(colorEvoHelpers)\n\nWarning: replacing previous import 'dplyr::where' by 'ape::where' when loading\n'colorEvoHelpers'\n\nlibrary(ggplot2)\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\nobs_data &lt;- readRDS(\"_targets/objects/obs_gridded\")\n\nobs_data$geometry &lt;- obs_data$cell\n\nsscs &lt;- obs_data %&gt;%\n  group_by(species, season, year, cell) %&gt;%\n  filter(n() &gt;= 30) %&gt;%\n  summarize(\n    cell = Mode(cell),\n    n_obs = n(), \n    obs=list(local_hour), # NEW NEW NEW MIGHT BREAK\n    unadj_median = median(local_hour)\n  )\n\n`summarise()` has grouped output by 'species', 'season', 'year'. You can\noverride using the `.groups` argument.\n\n\nLook at some individual SSCs for different species - the first two appear strongly unimodal, but the 3rd and 4th species appear to suggest some bimodality.\n\ngetObsFromSSCs &lt;- function(sscs, my_species, my_season, my_year, my_cell, plot=TRUE){\n  ssc &lt;- dplyr::filter(sscs,species==my_species,season==my_season,year==my_year,cell==my_cell)\n  obs &lt;- as.data.frame(unlist(ssc$obs))\n  colnames(obs) &lt;- c(\"hour\")\n  obs$year &lt;- my_year\n  obs$unadj_median &lt;- ssc$unadj_median\n  \n  if(plot){\n    p &lt;- ggplot(obs, aes(x = hour)) + \n      #geom_histogram(aes(y = ..density..), binwidth = 0.5, fill = \"skyblue\", color = \"black\") +\n    geom_density(alpha = 0.2, fill = \"blue\") +\n    geom_point(aes(x = unadj_median, y = 0), color = \"red\", size = 4) +\n    #geom_point(aes(x = median_value, y = 0), color = \"blue\", size = 4) +\n    ggtitle(my_species) +\n    xlab(\"Values\") + \n    ylab(\"Frequency\") +\n    theme_minimal()\n    \n    plot(p)\n  }\n  return(obs)\n}\n\nc_palla &lt;- getObsFromSSCs(sscs, \"Chlosyne palla\", 2, 2021, 132)\n\n\n\na_nicippe &lt;- getObsFromSSCs(sscs, \"Abaeis nicippe\", 1, 2021, 64)\n\n\n\na_jatrophae &lt;- getObsFromSSCs(sscs, \"Anartia jatrophae\", 1, 2022, 20)\n\n\n\np_vibex &lt;- getObsFromSSCs(sscs, \"Polites vibex\", 4, 2022, 12)\n\n\n\n\nSee if the dip test corresponds to these visible differences - in the dip test, a low p-value (typically &lt; 0.05) suggests that the null hypothesis of unimodality can be rejected, indicating the presence of multimodality in the distribution of your data.\n\nlibrary(diptest)\n\n# Perform the dip test\ndip(c_palla$hour)\n\n[1] 0.08333333\n\ndip(a_nicippe$hour)\n\n[1] 0.108871\n\ndip(p_vibex$hour)\n\n[1] 0.0875\n\ndip(a_jatrophae$hour)\n\n[1] 0.07317073\n\n\nWe can then bind these dip values into every SSC - could this be a reasonable bimodality metric?\n\nsscs &lt;- sscs %&gt;% mutate(unimod_p=dip(unlist(obs)))\n\nggplot(sscs, aes(x = unimod_p)) + \n  geom_density(alpha = 0.2, fill = \"blue\")"
  },
  {
    "objectID": "observer_timings.html",
    "href": "observer_timings.html",
    "title": "Extra: Observer Time Vetting",
    "section": "",
    "text": "So far the ones I’ve looked at are real, just superobservers that tend to prefer blacklighting and evenings\n\nlibrary(dplyr)\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggplot2)\n\nWarning: package 'ggplot2' was built under R version 4.2.2\n\nobs_timed &lt;- readRDS(\"_targets/objects/obs_timed\")\nobs_trimmed &lt;- obs_timed %&gt;% filter(local_hour &gt; 7 & local_hour &lt; 21)\n\nobservers &lt;- obs_timed %&gt;% group_by(recordedBy) %&gt;% summarize(local_hour=median(local_hour),n=n())\nobservers_trimmed &lt;- obs_trimmed %&gt;% group_by(recordedBy) %&gt;% summarize(local_hour=median(local_hour),n=n())\n\nhist(observers$local_hour,breaks=20)\n\n\n\nhist(observers_trimmed$local_hour,breaks=10)\n\n\n\nlate_observers &lt;- observers[observers$local_hour &gt; 17 & observers$n &gt; 50,]$recordedBy\nobs_alex &lt;- obs_timed %&gt;% filter(recordedBy == \"Alex\")\nhist(obs_alex$local_hour)\n\n\n\nobs_aidan &lt;- obs_timed %&gt;% filter(recordedBy == \"Aidan\")\nhist(obs_aidan$local_hour)\n\n\n\nView(obs_aidan)\n\nConstant hours don’t seem to be a problem really - there are no significant constant hour observers that don’t get filtered out - and I think the ones there are real, just where someone observed a few for an hour (for a class, for example) then quit forever\n\nconstant_hours &lt;- obs_timed %&gt;%\n  group_by(recordedBy) %&gt;%\n  filter(n_distinct(local_hour) == 1 & n() &gt; 10 & local_hour &gt; 7 & local_hour &lt; 20) %&gt;%\n  distinct(recordedBy) # Get unique recordedBy values\n\nprint(constant_hours)\n\n# A tibble: 5 × 1\n# Groups:   recordedBy [5]\n  recordedBy    \n  &lt;chr&gt;         \n1 anthonyh      \n2 Isabella Johns\n3 goingbuggy    \n4 m-eager       \n5 Mrs. Schenk"
  }
]